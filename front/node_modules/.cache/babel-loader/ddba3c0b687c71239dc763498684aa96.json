{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Fd-Formation\\\\Desktop\\\\Groupomania\\\\front\\\\src\\\\components\\\\App.js\";\nimport React from \"react\";\nimport axios from \"axios\";\nimport jwt_decode from \"jwt-decode\"; // Import components\n\nimport Header from \"./Header/Header\";\nimport Log from \"./Log/Log\";\nimport Home from \"./Home/Home\";\nimport Loader from \"./Loader/Loader\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default class App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      // DATAS\n      isLoading: false,\n      articles: null,\n      // LOG\n      isLogged: false,\n      userLogged: props.dataUser,\n      // NAV\n      curPage: props.curPage,\n      // ERROR\n      error: ''\n    };\n    this.userUrl = 'http://localhost:8080/api/user';\n    this.articlesUrl = 'http://localhost:8080/api/articles';\n    this.token = sessionStorage.getItem('token'); // DEBUG\n\n    console.warn('Enter APP');\n  }\n\n  componentDidMount() {\n    const {\n      articles,\n      curPage\n    } = this.state;\n    if (!articles || curPage === 'Home') this.getArticles();\n  } // Récupération des articles.\n\n\n  getArticles() {\n    this.setState({\n      isLoading: false\n    });\n    const {\n      isLogged,\n      userLogged\n    } = this.state;\n    console.log('[INFO] Loading articles...');\n    axios.get(this.articlesUrl).then(res => {\n      if (res.status === 204) this.setState({\n        articles: 0\n      });else this.setState({\n        articles: res.data.articles\n      });\n      console.warn('[SUCCESS] Articles loaded!');\n      if (!isLogged || !userLogged) this.checkLog();\n    }).catch(err => {\n      console.error('[ERROR] Loading articles error!');\n      console.log(err);\n      this.setState({\n        isLoading: false,\n        error: 'Une erreur est survenue! Réessayer plus tard.'\n      });\n    });\n  } // Vérification du jeton +\n  // Récupération des informations de l'utilisateur.\n\n\n  checkLog() {\n    const {\n      userLogged\n    } = this.state;\n    console.log('[INFO] Checking token...');\n\n    if (this.token) {\n      console.warn('[SUCCESS] Token found!');\n      console.log('[INFO] Checking User infos...');\n\n      if (!userLogged) {\n        console.warn('[ERROR] User infos not found!'); // Checking here the token with jwt\n\n        const decodedToken = jwt_decode(this.token, 'RANDOM_TOKEN_SECRET');\n\n        if (decodedToken && decodedToken.userId) {\n          console.log('[INFO] Get User infos with token...');\n          const getUserUrl = this.userUrl + '?id=' + decodedToken.userId;\n          axios.get(getUserUrl).then(user => {\n            console.warn('[SUCCESS] User infos with token found!');\n            this.setState({\n              curPage: 'Home',\n              userLogged: user.data.user,\n              isLogged: true,\n              isLoading: false\n            });\n          }).catch(error => {\n            console.warn('[ERROR] User infos with token not found!');\n            this.setState({\n              curPage: 'Login',\n              userLogged: null,\n              isLogged: false,\n              isLoading: false\n            });\n          });\n        } else this.setState({\n          curPage: 'Login',\n          isLogged: false,\n          isLoading: false\n        });\n      } else {\n        console.warn('[SUCCESS] User infos found!');\n        this.setState({\n          curPage: 'Home',\n          isLogged: true,\n          isLoading: false\n        });\n      }\n    } else {\n      console.warn('[INFO] Token not found!');\n      this.setState({\n        curPage: 'Login',\n        userLogged: null,\n        isLogged: false,\n        isLoading: false\n      });\n    }\n  } // Mise en page des composants.\n\n\n  setComponent() {\n    const {\n      curPage,\n      articles,\n      userLogged\n    } = this.state;\n\n    switch (curPage) {\n      case 'Login':\n        return /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(Log, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 19\n          }, this)\n        }, void 0, false);\n\n      case 'Home':\n        return /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(Home, {\n            articles: articles,\n            userLogged: userLogged\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 100,\n            columnNumber: 19\n          }, this)\n        }, void 0, false);\n\n      default:\n        break;\n    }\n  } // Rechargement de l'API.\n\n\n  static ReloadApp() {\n    console.log('Reloading App!');\n    window.location.reload(false);\n  }\n\n  render() {\n    const {\n      error,\n      isLoading\n    } = this.state;\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: !isLoading ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"main\", {\n          children: [error || error !== '' ? /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"error\",\n            children: error\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 36\n          }, this) : null, this.setComponent()]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(Loader, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 14\n      }, this)\n    }, void 0, false);\n  }\n\n}","map":{"version":3,"names":["React","axios","jwt_decode","Header","Log","Home","Loader","App","Component","constructor","props","state","isLoading","articles","isLogged","userLogged","dataUser","curPage","error","userUrl","articlesUrl","token","sessionStorage","getItem","console","warn","componentDidMount","getArticles","setState","log","get","then","res","status","data","checkLog","catch","err","decodedToken","userId","getUserUrl","user","setComponent","ReloadApp","window","location","reload","render"],"sources":["C:/Users/Fd-Formation/Desktop/Groupomania/front/src/components/App.js"],"sourcesContent":["import React from \"react\";\nimport axios from \"axios\";\nimport jwt_decode from \"jwt-decode\";\n// Import components\nimport Header from \"./Header/Header\";\nimport Log from \"./Log/Log\";\nimport Home from \"./Home/Home\";\nimport Loader from \"./Loader/Loader\";\n\nexport default class App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      // DATAS\n      isLoading: false,\n      articles: null,\n      // LOG\n      isLogged: false,\n      userLogged: props.dataUser,\n      // NAV\n      curPage: props.curPage,\n      // ERROR\n      error: ''\n    }\n    this.userUrl = 'http://localhost:8080/api/user';\n    this.articlesUrl = 'http://localhost:8080/api/articles';\n    this.token = sessionStorage.getItem('token');\n    // DEBUG\n    console.warn('Enter APP');\n  }\n\n  componentDidMount() {\n    const { articles, curPage } = this.state;\n    if (!articles || curPage === 'Home') this.getArticles();\n  }\n\n  // Récupération des articles.\n  getArticles() {\n    this.setState({ isLoading: false });\n    const { isLogged, userLogged } = this.state;\n    console.log('[INFO] Loading articles...');\n    axios.get(this.articlesUrl).then((res) => {\n      if (res.status === 204) this.setState({ articles: 0 });\n      else this.setState({ articles: res.data.articles });\n      console.warn('[SUCCESS] Articles loaded!');\n      if (!isLogged || !userLogged) this.checkLog();\n    })\n      .catch((err) => {\n        console.error('[ERROR] Loading articles error!');\n        console.log(err);\n        this.setState({ isLoading: false, error: 'Une erreur est survenue! Réessayer plus tard.' });\n      });\n  }\n\n  // Vérification du jeton +\n  // Récupération des informations de l'utilisateur.\n  checkLog() {\n    const { userLogged } = this.state;\n    console.log('[INFO] Checking token...');\n    if (this.token) {\n      console.warn('[SUCCESS] Token found!');\n      console.log('[INFO] Checking User infos...');\n      if (!userLogged) {\n        console.warn('[ERROR] User infos not found!');\n        // Checking here the token with jwt\n        const decodedToken = jwt_decode(this.token, 'RANDOM_TOKEN_SECRET');\n        if (decodedToken && decodedToken.userId) {\n          console.log('[INFO] Get User infos with token...');\n          const getUserUrl = this.userUrl + '?id=' + decodedToken.userId;\n          axios.get(getUserUrl).then((user) => {\n            console.warn('[SUCCESS] User infos with token found!');\n            this.setState({ curPage: 'Home', userLogged: user.data.user, isLogged: true, isLoading: false });\n          })\n            .catch((error) => {\n              console.warn('[ERROR] User infos with token not found!');\n              this.setState({ curPage: 'Login', userLogged: null, isLogged: false, isLoading: false });\n            });\n        }\n        else\n          this.setState({ curPage: 'Login', isLogged: false, isLoading: false });\n      }\n      else {\n        console.warn('[SUCCESS] User infos found!');\n        this.setState({ curPage: 'Home', isLogged: true, isLoading: false });\n      }\n    }\n    else {\n      console.warn('[INFO] Token not found!');\n      this.setState({ curPage: 'Login', userLogged: null, isLogged: false, isLoading: false });\n    }\n  }\n\n  // Mise en page des composants.\n  setComponent() {\n    const { curPage, articles, userLogged } = this.state;\n    switch (curPage) {\n      case 'Login':\n        return (<><Log /></>);\n      case 'Home':\n        return (<><Home articles={articles} userLogged={userLogged} /></>);\n      default:\n        break;\n    }\n  }\n\n  // Rechargement de l'API.\n  static ReloadApp() {\n    console.log('Reloading App!');\n    window.location.reload(false);\n  }\n\n  render() {\n    const { error, isLoading } = this.state;\n    return (<>\n      {!isLoading ? (<>\n        <Header />\n        <main>\n          {error || error !== '' ? <p className=\"error\">{error}</p> : null}\n          {this.setComponent()}\n        </main>\n      </>) : <Loader />}\n    </>)\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}